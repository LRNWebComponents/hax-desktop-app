<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/hax-body/hax-store.html">
<link rel="import" href="../../bower_components/hax-body/hax-body.html">
<link rel="import" href="../../bower_components/hax-body/hax-autoloader.html">
<link rel="import" href="../../bower_components/hax-body/hax-manager.html">
<link rel="import" href="../../bower_components/hax-body/hax-source.html">
<link rel="import" href="../../bower_components/hax-body/hax-panel.html">
<link rel="import" href="../../bower_components/hax-body/hax-export-dialog.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">

<dom-module id="hax-app-page">
  <template>
    <style>
      :host {
        display: block;
      }

      hax-body {
        max-width: 60em;
        margin-left: 10em;
      }

      hax-body {
        margin-right: 0px;
      }

      hax-panel {
        font-size: .8rem;
      }

      hax-panel {
        --app-drawer-content-container: {
          background-color: #fafafa;
          padding: 0;
          border-right: 1px solid #c8c8c8;
          border-bottom: 1px solid #c8c8c8;
          width: 100px !important;
          box-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.4);
          height: 100vh;
          position: fixed;
        }
      }

      lrnsys-collapselist-item .label {
        text-align: center;
      }
    </style>

    <h1>[[activePage]]</h1>

    <hax-store></hax-store>
    <hax-body id="haxbody" context-offset-left="-558">
    </hax-body>
    <hax-export-dialog></hax-export-dialog>
    <hax-panel>
      <hax-panel-item icon="save" icon-class="purple-text text-darken-2" label="Save" event-name="save" voice-command="save" on-click="save"></hax-panel-item>
    </hax-panel>
    <hax-autoloader hidden>
      <video-player></video-player>
      <wikipedia-query></wikipedia-query>
      <pdf-element></pdf-element>
      <lrn-table></lrn-table>
      <media-image></media-image>
      <a11y-gif-player></a11y-gif-player>
      <aframe-player></aframe-player>
      <paper-audio-player></paper-audio-player>
    </hax-autoloader>
    <hax-manager>
      <hax-source
        search
        details='{
        "title":"Media",
        "icon":"perm-media",
        "color":"blue",
        "author": "ELMS: Learning Network",
        "teaser": "Our media solution",
        "description": "The backend for ELMS:LN that allows for asset management and recall. Allows for remote referencing of things as well as tagging them by course so that we know where things are used after the fact.",
        "status": "available"
        }'
        name="ELMS:LN Media"
        user="SERVICE_ELMSMEDIA_LN"
        pass="106025726eea79168e7b9d3aff6330"
        request-end-point="http://data-media.elmsln.local/node.json"
        request-params='{
        "deep-load-refs":"file",
        "title":""}'
        query-param="title"
        response-map='{
          "root": "list",
          "gizmoType": "image",
          "url": "",
          "id": "field_image.url",
          "title": "title",
          "description": "body",
          "image": "field_image.url"}'></hax-source>
      <hax-source
        search
        details='{
        "title":"NASA media",
        "icon":"places:all-inclusive",
        "color":"blue",
        "author": "NASA",
        "teaser": "Space images and video",
        "description": "All the amazing shots of the worlds beyond our own for all to use.",
        "status": "available"
        }'
        request-end-point="https://images-api.nasa.gov/search"
        request-params='{
        "q":""}'
        query-param="q"
        response-map='{
          "root": "collection.items",
          "gizmoType": "image",
          "url": "",
          "id": "links.0.href",
          "title": "data.0.title",
          "description": "data.0.description",
          "image": "links.0.href",
          "customGizmoType": "data.0.media_type"}'></hax-source>
      <hax-source
        search
        details='{
        "title":"CC Mixter",
        "icon":"av:library-music",
        "color":"orange",
        "author": "CC Mixter",
        "teaser": "Creative commons audio",
        "description": "User submitted audio files and music.",
        "status": "available"
        }'
        request-end-point="http://ccmixter.org/api/query"
        request-params='{
        "tags":"",
        "format":"json",
        "sort":"name",
        "limit":"20"}'
        query-param="tags"
        response-map='{
          "root": "",
          "gizmoType": "audio",
          "url": "",
          "id": "files.0.download_url",
          "title": "upload_name",
          "description": "upload_description_plain",
          "image": "license_logo_url"}'></hax-source>
      <hax-source
        search
        details='{
        "title":"Unsplash",
        "icon":"image:collections",
        "color":"grey",
        "author": "Unsplash",
        "teaser": "Crowd sourced, open photos",
        "description": "A massive library of open photos that just requiring citing who made it.",
        "status": "available"
        }'
        request-end-point="https://api.unsplash.com/search/photos"
        request-params='{
        "query":"",
        "client_id":"0e1fa3a203724415c10c03581e8db8a43e8bc8906ad934e0f321d28be16281ff",
        "page":"1"}'
        query-param="query"
        response-map='{
          "root": "results",
          "gizmoType": "image",
          "url": "",
          "id": "urls.regular",
          "title": "data.0.title",
          "description": "description",
          "image": "urls.thumb"}'></hax-source>
      <hax-source
        search
        details='{
        "title":"Youtube",
        "icon":"av:play-arrow",
        "color":"red",
        "author": "Google, Youtube LLC",
        "teaser": "Popular public video solution",
        "description": "Remember that anything you place here though will be out in the open. Great for OER.",
        "status": "available"
        }'
        request-end-point="https://www.googleapis.com/youtube/v3/search"
        request-params='{
        "part":"snippet",
        "q":"",
        "key": "AIzaSyAF9zKXv-fxus9GNqn40SHzTn6F8A7h-Yo",
        "type": "video",
        "maxResults":"12"}'
        query-param="q"
        response-map='{
          "root": "items",
          "gizmoType": "video",
          "url": "https://www.youtube.com/watch?v=",
          "id": "id.videoId",
          "title": "snippet.title",
          "description": "snippet.description",
          "image": "snippet.thumbnails.high.url"}'></hax-source>
      <hax-source
        search
        details='{
        "title":"Vimeo",
        "icon":"av:play-circle-filled",
        "color":"blue",
        "author": "Vimeo Inc.",
        "teaser": "Popular video community",
        "description": "Vimeo is a great place for artists and higher quality video. There is also the ability to have more control over the storage and delivery of media as needed.",
        "status": "available"
        }'
        request-end-point="https://api.vimeo.com/videos"
        request-params='{
        "access_token": "0a718b853bad87571d52e9fb554e0a43",
        "query": "",
        "direction": "asc",
        "sort": "alphabetical",
        "filter": "CC",
        "per_page":"12"
        }'
        query-param="query"
        response-map='{
          "root": "data",
          "gizmoType": "video",
          "url": "https://vimeo.com",
          "id": "uri",
          "title": "name",
          "description": "description",
          "image": "pictures.sizes.1.link"}'></hax-source>
    </hax-manager>

    <paper-toast id="notification"></paper-toast>

  </template>

  <script>

    Polymer({

      is: 'hax-app-page',

      properties: {
        activePage: {
          type: String,
          value: ''
        },
        content: {
          type: String,
          value: '',
          observer: '_contentChanged'
        }
      },

      _contentChanged: function (content, oldContent) {
        // quick dirty check
        if (content === oldContent) return;
        // update hax body content
        if (this.__haxBody) {
          Polymer.dom(this.$$('hax-body')).innerHTML = content;
        }
      },

      save: function () {
        const haxBody = this.$$('hax-body');
        const haxContent = haxBody.haxToContent();
        ipcRenderer.send('save-page', haxContent);
      },

      attached: function () {
        this.__haxBody = this.$$('hax-body');

        // Listen for saves
        this.addEventListener('save', (e) => {
          console.log(e);
        })

        ipcRenderer.on('save-page-success', (e) => {
          this.$.notification.show('Page saved');
        });
        
        // listen for the active page to change then update hax-body
        // with the new content
        ipcRenderer.on('active-page-changed', (e, page) => {
          this.activePage = page;
        });
        ipcRenderer.on('active-content-changed', (e, content) => {
          this.content = content;
        });
      }

    });
  </script>
</dom-module>