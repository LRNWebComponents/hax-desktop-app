<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/hax-body/hax-store.html">
<link rel="import" href="../../bower_components/hax-body/hax-body.html">
<link rel="import" href="../../bower_components/hax-body/hax-autoloader.html">
<link rel="import" href="../../bower_components/hax-body/hax-manager.html">
<link rel="import" href="../../bower_components/hax-body/hax-source.html">
<link rel="import" href="../../bower_components/hax-body/hax-panel.html">
<link rel="import" href="../../bower_components/hax-body/hax-export-dialog.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">

<dom-module id="hax-app-page">
  <template>
    <style>
      :host {
        display: block;
      }

      hax-body {
        max-width: 60em;
        margin-left: 10em;
      }

      hax-panel {
        font-size: .8rem;
      }

      hax-panel {
        --app-drawer-content-container: {
          background-color: #fafafa;
          padding: 0;
          border-right: 1px solid #c8c8c8;
          border-bottom: 1px solid #c8c8c8;
          width: 100px !important;
          box-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.4);
          height: 100vh;
          position: fixed;
        }
      }

      lrnsys-collapselist-item .label {
        text-align: center;
      }
    </style>

    <h1>[[activePage]]</h1>
    hax-app-page

    <hax-store></hax-store>
    <hax-body id="haxbody" context-offset-left="-164">

    </hax-body>
    <hax-export-dialog></hax-export-dialog>
    <hax-panel>
      <lrnsys-collapselist-item>
        <span slot="label">
          <div class="label">Future</div>
        </span>
        <span slot="content">
          <hax-panel-item icon="touch-app" icon-class="blue-text" label="Interactive video" event-name="h5p-interactive-video" voice-command="insert interactive video"></hax-panel-item>
          <hax-panel-item icon="hardware:videogame-asset" icon-class="red-text" label="Self-check" event-name="h5p-multiple-choice"
            voice-command="insert self check"></hax-panel-item>
          <hax-panel-item icon="timeline" icon-class="yellow-text text-darken-4" label="Timeline" event-name="timeline" voice-command="insert timeline"></hax-panel-item>
          <hax-panel-item icon="maps:place" icon-class="green-text" label="Map" event-name="map" voice-command="insert map"></hax-panel-item>
          <hax-panel-item icon="social:share" icon-class="pink-text" label="JMOL" event-name="jmol" voice-command="insert molecule"></hax-panel-item>
          <hax-panel-item icon="social:poll" icon-class="orange-text" label="Poll" event-name="poll" voice-command="insert poll"></hax-panel-item>
          <hax-panel-item icon="assignment" icon-class="yellow-text text-darken-2" label="Assignment" event-name="assignment" voice-command="insert assignment"></hax-panel-item>
          <hax-panel-item icon="assessment" icon-class="purple-text text-darken-2" label="Quiz" event-name="quiz" voice-command="insert quiz"></hax-panel-item>
        </span>
      </lrnsys-collapselist-item>
      <lrnsys-collapselist-item>
        <span slot="label">
          <div class="label">Save</div>
        </span>
        <span slot="content">
          <hax-panel-item icon="save" icon-class="purple-text text-darken-2" label="Save" event-name="save" voice-command="save" on-click="save"></hax-panel-item>
        </span>
      </lrnsys-collapselist-item>
    </hax-panel>
    <hax-autoloader hidden>
      <video-player></video-player>
      <wikipedia-query></wikipedia-query>
      <pdf-element></pdf-element>
      <lrn-table></lrn-table>
      <media-image></media-image>
      <a11y-gif-player></a11y-gif-player>
      <aframe-player></aframe-player>
    </hax-autoloader>
    <hax-manager>
      <hax-source details='{
    "title":"Media",
    "icon":"perm-media",
    "color":"blue",
    "author": "ELMS: Learning Network",
    "teaser": "Our media solution",
    "description": "The backend for ELMS:LN that allows for asset management and recall. Allows for remote referencing of things as well as tagging them by course so that we know where things are used after the fact.",
    "status": "available"
    }' name="ELMS:LN Media" user="SERVICE_ELMSMEDIA_LN" pass="106025726eea79168e7b9d3aff6330" request-end-point="http://data-media.elmsln.local/node.json"
        request-params='{
    "deep-load-refs":"file",
    "title":""}' query-param="title" response-map='{
      "root": "list",
      "gizmoType": "image",
      "url": "",
      "id": "field_image.url",
      "title": "title",
      "description": "body",
      "image": "field_image.url"}'></hax-source>
      <hax-source details='{
    "title":"Youtube",
    "icon":"av:play-arrow",
    "color":"red",
    "author": "Google, Youtube LLC",
    "teaser": "Popular public video solution",
    "description": "Remember that anything you place here though will be out in the open. Great for OER.",
    "status": "available"
    }' request-end-point="https://www.googleapis.com/youtube/v3/search" request-params='{
    "part":"snippet",
    "q":"",
    "key": "AIzaSyAF9zKXv-fxus9GNqn40SHzTn6F8A7h-Yo",
    "type": "video",
    "maxResults":"12"}' query-param="q" response-map='{
      "root": "items",
      "gizmoType": "video",
      "url": "https://www.youtube.com/watch?v=",
      "id": "id.videoId",
      "title": "snippet.title",
      "description": "snippet.description",
      "image": "snippet.thumbnails.high.url"}'></hax-source>
      <hax-source details='{
    "title":"Vimeo",
    "icon":"av:play-circle-filled",
    "color":"blue",
    "author": "Vimeo Inc.",
    "teaser": "Popular video community",
    "description": "Vimeo is a great place for artists and higher quality video. There is also the ability to have more control over the storage and delivery of media as needed.",
    "status": "available"
    }' request-end-point="https://api.vimeo.com/videos" request-params='{
    "access_token": "0a718b853bad87571d52e9fb554e0a43",
    "query": "",
    "direction": "asc",
    "sort": "alphabetical",
    "filter": "CC",
    "per_page":"12"
    }' query-param="query" response-map='{
      "root": "data",
      "gizmoType": "video",
      "url": "",
      "id": "link",
      "title": "name",
      "description": "description",
      "image": "pictures.sizes.1.link"}'></hax-source>
    </hax-manager>

    <paper-toast id="notification"></paper-toast>

  </template>

  <script>

    Polymer({

      is: 'hax-app-page',

      properties: {
        activePage: {
          type: String,
          value: ''
        },
        content: {
          type: String,
          value: '',
          observer: '_contentChanged'
        }
      },

      _contentChanged: function (content, oldContent) {
        // quick dirty check
        if (content === oldContent) return;
        // update hax body content
        this.$.haxbody.innerHTML = content;
      },

      save: function () {
        const haxBody = this.$$('hax-body');
        const haxContent = haxBody.haxToContent();
        ipcRenderer.send('save-page', haxContent);
      },

      attached: function () {
        const haxBody = this.$$('hax-body');

        // Listen for saves
        this.addEventListener('save', (e) => {
          console.log(e);
        })

        ipcRenderer.on('save-page-success', (e) => {
          this.$.notification.show('Page saved');
        });
        
        // listen for the active page to change then update hax-body
        // with the new content
        ipcRenderer.on('active-page-changed', (e, page) => {
          this.activePage = page;
        });
        ipcRenderer.on('active-content-changed', (e, content) => {
          this.content = content;
        });
      }

    });
  </script>
</dom-module>